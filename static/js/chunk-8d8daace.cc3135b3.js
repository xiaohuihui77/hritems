(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8d8daace"],{"1eef":function(e,t,a){"use strict";a.d(t,"c",(function(){return n})),a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return d})),a.d(t,"d",(function(){return o}));var r=a("b775");function n(){return Object(r["a"])({url:"/company/department",method:"get"})}var s=function(e){return Object(r["a"])({url:"/company/department/"+e,method:"delete"})},d=function(e){return Object(r["a"])({url:"/company/department",method:"post",data:e})},o=function(e,t){return Object(r["a"])({url:"/company/department/"+e,method:"put",data:t})}},"50b2":function(e,t,a){},"6cb3":function(e,t,a){"use strict";a("50b2")},fb3b:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"departments"},[[a("div",{staticClass:"dashboard-container"},[a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"tree-card"},[a("tree-tools",{attrs:{"tree-node":e.company},on:{addDeparts:e.addDepts}}),a("el-tree",{attrs:{data:e.departs,props:e.defaultProps,"default-expand-all":""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.data;return a("tree-tools",{attrs:{"tree-node":r,"is-root":""},on:{delOut:e.resetData,addDeparts:e.addDepts,editDeparts:e.editDepts}})}}])})],1)],1)])],a("add-dept",{ref:"addDept",attrs:{"tree-node":e.node,"simple-user":e.simpleUser,"show-dialog":e.showDialog},on:{cancel:e.cancel,add:e.addDepart,edit:e.editDepart}})],2)},n=[],s=a("c7eb"),d=a("1da1"),o=a("5530"),i=(a("d81d"),a("4de4"),a("d3b7"),a("b0c0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticStyle:{height:"40px",width:"100%"},attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("el-col",[a("span",[e._v(e._s(e.treeNode.name))])]),a("el-col",{attrs:{span:4}},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",[e._v(e._s(e.treeNode.manager))]),a("el-col",[a("el-dropdown",{on:{command:e.handleCommand}},[a("span",[e._v(" 操作"),a("i",{staticClass:"el-icon-arrow-down"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"add"}},[e._v("添加子部门")]),e.isRoot?a("el-dropdown-item",{attrs:{command:"edit"}},[e._v("编辑部门")]):e._e(),e.isRoot?a("el-dropdown-item",{attrs:{command:"del"}},[e._v("删除部门")]):e._e()],1)],1)],1)],1)],1)],1)}),c=[],l=a("1eef"),u={props:{treeNode:{type:Object,required:!0},isRoot:{type:Boolean,default:!1}},methods:{handleCommand:function(e){var t=this;"add"===e?this.$emit("addDeparts",this.treeNode):"edit"===e?this.$emit("editDeparts",this.treeNode):"del"===e&&this.$confirm("是否确认删除该部门？").then((function(){return Object(l["b"])(t.treeNode.id)})).then((function(){t.$emit("delOut"),t.$message.success("删除成功")}))}}},p=u,m=a("2877"),f=Object(m["a"])(p,i,c,!1,null,null,null),h=f.exports,b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.addDeparts.id?"编辑部门":"添加部门",visible:e.showDialog,"show-close":!0,"before-close":e.cancel},on:{close:e.empty}},[a("el-form",{ref:"ruleForm",attrs:{"label-width":"120px",model:e.addDeparts,rules:e.rules}},[a("el-form-item",{attrs:{label:"部门名称",prop:"name"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"1-50个字符"},model:{value:e.addDeparts.name,callback:function(t){e.$set(e.addDeparts,"name",t)},expression:"addDeparts.name"}})],1),a("el-form-item",{attrs:{label:"部门编码",prop:"code"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"1-50个字符"},model:{value:e.addDeparts.code,callback:function(t){e.$set(e.addDeparts,"code",t)},expression:"addDeparts.code"}})],1),a("el-form-item",{attrs:{label:"部门负责人",prop:"manager"}},[a("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"请选择"},model:{value:e.addDeparts.manager,callback:function(t){e.$set(e.addDeparts,"manager",t)},expression:"addDeparts.manager"}},e._l(e.simpleUser,(function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.username}})})),1)],1),a("el-form-item",{attrs:{label:"部门介绍",prop:"introduce"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"1-300个字符",type:"textarea",rows:3},model:{value:e.addDeparts.introduce,callback:function(t){e.$set(e.addDeparts,"introduce",t)},expression:"addDeparts.introduce"}})],1)],1),a("el-row",{attrs:{slot:"footer",type:"flex",justify:"center"},slot:"footer"},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirm}},[e._v("确定")]),a("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)},g=[],D=(a("498a"),a("d9e2"),{props:{showDialog:{type:Boolean,default:!1},simpleUser:{type:Array,default:function(){return[]}},treeNode:{type:Object,default:function(){}}},data:function(){var e=this,t=function(){var t=Object(d["a"])(Object(s["a"])().mark((function t(a,r,n){var d,o,i;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["c"])();case 2:d=t.sent,o=d.data,i=!1,i=e.addDeparts.id?o.depts.filter((function(t){return t.pid===e.treeNode.pid&&t.id!==e.treeNode.id})).some((function(e){return e.name===r.trim()})):o.depts.filter((function(t){return t.pid===(e.treeNode.id||"")})).some((function(e){return e.name===r.trim()})),i?n(new Error("部门名称已存在")):n();case 7:case"end":return t.stop()}}),t)})));return function(e,a,r){return t.apply(this,arguments)}}(),a=function(){var t=Object(d["a"])(Object(s["a"])().mark((function t(a,r,n){var d,o,i;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["c"])();case 2:d=t.sent,o=d.data,i=!1,i=e.addDeparts.id?o.depts.some((function(t){return t.code===r.trim()&&t.id!==e.treeNode.id})):o.depts.some((function(e){return e.code===r.trim()})),i?n(new Error("编号已存在")):n();case 7:case"end":return t.stop()}}),t)})));return function(e,a,r){return t.apply(this,arguments)}}();return{addDeparts:{name:"",code:"",manager:"",introduce:"",dialogTitle:""},rules:{name:[{required:!0,message:"请输入部门名字",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"},{validator:t,trigger:"blur"}],code:[{required:!0,message:"部门编码不能为空",trigger:"blur"},{min:1,max:50,message:"部门编码要求1-50个字符",trigger:"blur"},{validator:a,trigger:"blur"}],manager:[{required:!0,message:"部门负责人不能为空",trigger:"blur"}],introduce:[{required:!0,message:"部门介绍不能为空",trigger:"blur"},{trigger:"blur",min:1,max:300,message:"部门介绍要求1-50个字符"}]}}},methods:{cancel:function(){this.$emit("cancel")},confirm:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(!t)return!1;e.addDeparts.id?e.$emit("edit",e.addDeparts):e.$emit("add",e.addDeparts)}))},empty:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.addDeparts=e||{name:"",code:"",manager:"",introduce:""},this.$refs.ruleForm.resetFields()},setAddDeparts:function(e){this.addDeparts=e}}}),v=D,w=Object(m["a"])(v,b,g,!1,null,null,null),y=w.exports,j=a("c24f"),O={components:{treeTools:h,addDept:y},data:function(){return{showDialog:!1,company:{name:"江苏传智播客教育科技股份有限公司",manager:"负责人"},departs:[],defaultProps:{label:"name"},departmentAll:{},node:{},simpleUser:[]}},created:function(){this.getDepartmentAll()},methods:{findChild:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.filter((function(e){return e.pid===a})).map((function(a){return Object(o["a"])(Object(o["a"])({},a),{},{children:t.findChild(e,a.id)})}))},getDepartmentAll:function(){var e=this;return Object(d["a"])(Object(s["a"])().mark((function t(){var a,r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(l["c"])();case 3:a=t.sent,r=a.data,e.departmentAll=r,e.company.name=r.companyName,e.departs=e.findChild(r.depts),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),e.$message.error(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},resetData:function(){this.getDepartmentAll()},addDepts:function(e){var t=this;this.node=e,Object(j["g"])().then((function(e){t.simpleUser=e.data,t.showDialog=!0}))},editDepts:function(e){var t=this;this.node=e,Object(j["g"])().then((function(a){t.simpleUser=a.data,t.$refs.addDept.empty(e),t.showDialog=!0})),this.showDialog=!0},cancel:function(){this.showDialog=!1},addDepart:function(e){var t=this;Object(l["a"])(Object(o["a"])(Object(o["a"])({},e),{},{pid:this.node.id||""})).then((function(e){t.$message.success("添加成功"),t.showDialog=!1,t.resetData()})).catch((function(e){return e}))},editDepart:function(e){var t=this;Object(l["d"])(e.id,e).then((function(e){t.$message.success("修改成功"),t.showDialog=!1,t.resetData()})).catch((function(e){return e}))}}},x=O,$=(a("6cb3"),Object(m["a"])(x,r,n,!1,null,"1b0388a0",null));t["default"]=$.exports}}]);